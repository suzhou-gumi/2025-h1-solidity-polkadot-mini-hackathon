链上抽签应用 - 完整功能大纲
这是一个包含所有讨论功能的链上抽签应用的设计大纲。

1. 智能合约架构 (Solidity)
主合约 (LotteryFactory / LotteryManager):

负责创建和管理所有独立的抽奖场次实例。

维护一个从抽奖 ID 到抽奖实例合约地址的映射。

提供发起新抽奖的函数。

提供查询公开抽奖列表的函数。

可能包含全局的暂停/升级等管理功能 (由主合约部署者控制)。

抽奖实例合约 (LotteryInstance):

每个抽奖场次对应一个独立的合约实例。

包含该场次的所有状态变量 (名称、ID、描述、入场费、参与者、中奖者、奖池、开奖时间、状态、白名单、管理者列表等)。

包含该场次的所有操作函数 (参与、开奖、领奖、添加/移除白名单、添加/移除管理者、修改开奖时间等)。

继承 Ownable 或类似的权限管理库，管理该场次的发起人 (Owner) 和管理者 (Managers) 权限。

2. 核心功能模块
2.1 用户角色与入口
入口页面： 用户连接钱包后，选择“参与抽奖”或“发起抽奖”。

发起抽奖： 引导用户进入发起流程，填写抽奖信息并部署新的抽奖实例合约。

参与抽奖：

公开大厅： 显示所有设置为公开的抽奖场次列表。

通过 ID 加入： 提供输入框，用户输入抽奖 ID 直接进入特定场次页面。

2.2 发起抽奖流程
填写抽奖信息：

抽奖名称 (字符串)

抽奖 ID (字符串，用户自定义，需检查唯一性)

抽奖描述 (字符串)

选择模式：公开 / 私密 (白名单)

如果选择私密，提供输入框添加白名单地址列表 (支持批量粘贴，前端处理换行)。

参与人数上限 (可选，uint256)

开奖时间 (时间戳 uint256)

奖池设置：

选择奖池模式：“发起人固定奖池” 或 “发起人保底 + 入场费累积”。

如果固定奖池或保底模式，输入初始/保底金额。

如果入场费累积模式，设置入场费。

是否允许外部资金注入 (赞助) (布尔值，默认勾选)。

设置管理者 (仅私密抽奖)： 提供输入框添加一个或多个管理者地址列表。

确认与部署： 用户确认信息，前端调用主合约的“发起抽奖”函数，向链上部署新的抽奖实例合约，并支付部署 Gas 费和初始/保底奖池资金。

2.3 抽奖场次管理 (发起人/管理者权限)
查看场次详情： 发起人和管理者可以查看该场次的所有详细信息，包括参与者列表、白名单列表、管理者列表、当前奖池等。

白名单管理 (仅私密抽奖的发起人和管理者)：

添加新的白名单地址。

移除白名单地址。

管理者管理 (仅私密抽奖的发起人)：

添加新的管理者地址。

移除管理者地址。

修改开奖时间 (发起人和特定权限的管理者)： 允许在开奖前修改预设的开奖时间。

触发开奖 (发起人和特定权限的管理者)： 在开奖时间到达后，可以手动触发开奖。

重置抽奖 (发起人和特定权限的管理者)： 在奖金领取后或需要时，重置该场次抽奖。

2.4 参与抽奖流程
进入场次页面： 通过公开大厅列表或输入 ID 进入特定抽奖场次的详情页面。

查看抽奖信息： 显示该场次的所有公开信息 (名称、描述、入场费、当前奖池、开奖时间、当前参与人数)。

参与资格检查： 前端根据抽奖模式 (公开/私密) 和白名单检查当前连接的钱包地址是否符合参与条件。

参与操作：

如果符合条件：显示“参与”按钮。

如果需要支付入场费：按钮显示需支付的金额。

用户点击“参与”，前端调用该抽奖实例合约的 enter() 函数，并根据需要发送代币。

状态更新： 参与成功后，前端更新参与人数和奖池显示。

2.5 开奖与领奖
开奖触发：

达到开奖时间后，发起人或有权限的管理者可以手动调用 drawWinner() 函数触发开奖。

(进阶) 考虑链上自动化开奖机制 (需要预言机或 Keeper 服务，复杂)。

中奖者确定： 合约内部执行随机数逻辑，确定中奖者地址。

结果公布： 前端监听合约事件，显示中奖者地址和奖金金额。

领奖操作：

中奖者连接钱包进入该场次页面。

前端检查当前连接的钱包地址是否是中奖者。

如果是，显示“领取奖金”按钮。

中奖者点击按钮，前端调用 claimPrize() 函数。

合约将奖池金额转给中奖者。

2.6 赞助系统
赞助入口： 提供一个独立的入口或在抽奖详情页，用户可以输入抽奖 ID 进行赞助。

赞助操作： 用户指定赞助金额，前端调用该抽奖实例合约的 sponsor() 或 donate() 函数并发送代币。

有效性检查： 合约检查输入的抽奖 ID 是否有效且抽奖未结束。

奖池更新： 赞助金额计入该场次的奖池。

赞助者记录 (可选)： 可以在合约中记录赞助者列表和金额。

2.7 查询功能
通过 ID 查询： 提供输入框，用户输入抽奖 ID，前端调用主合约查询该场次信息，然后显示详细页面。

显示信息： 抽奖名称、ID、描述、发起人、入场费、当前奖池、开奖时间、状态、参与者列表、中奖者 (开奖后)、赞助者列表 (如果记录)。

历史查询： 由于 ID 不释放，用户可以查询任何已结束的抽奖场次的历史信息和结果。

2.8 链接分享
链接生成： 前端为每个抽奖场次生成一个唯一的分享链接，例如 yourdapp.com/lottery/[:lotteryId]。

链接解析： 用户点击链接，前端应用解析 URL 中的 ID，并直接跳转到该抽奖场次的详情页面。

2.9 错误处理与提示
智能合约： 在所有可能失败的操作中，使用 require() 或 revert() 提供清晰的错误信息 (例如，require(condition, unicode"错误原因描述");)。

前端： 捕获合约返回的错误信息，并以用户友好的方式显示在界面上 (例如，弹窗提示“支付的入场费不正确”)。

加载状态： 在发送交易或查询数据时，显示加载状态，避免用户困惑。

链上抽签应用 - 基础版大纲 (黑客松 MVP)
这是一个更简单的基础版大纲，专注于实现核心的多场次抽奖功能，适合在黑客松期间作为最小可用产品 (MVP)。

1. 智能合约架构 (Solidity)
主合约 (LotteryFactory):

负责创建和管理多个独立的抽奖场次实例。

维护一个从抽奖 ID (用户自定义字符串) 到抽奖实例合约地址的映射。

提供发起新抽奖的函数。

提供查询所有抽奖列表的函数 (简化版，不区分公开/私密)。

抽奖实例合约 (SimpleLottery):

每个抽奖场次对应一个独立的合约实例。

包含该场次的基本状态变量 (ID, 名称, 入场费, 参与者, 中奖者, 奖池, 开奖时间, 状态)。

包含核心操作函数 (参与, 开奖, 领奖)。

继承 Ownable 管理该场次的发起人 (Owner) 权限 (开奖和重置)。

2. 核心功能模块 (基础版)
2.1 用户入口
入口页面： 用户连接钱包后，显示所有已创建的抽奖列表。提供“发起抽奖”按钮。

2.2 发起抽奖 (基础版)
填写基本信息：

抽奖名称 (字符串)

抽奖 ID (字符串，用户自定义，需检查唯一性)

入场费 (uint256) - 奖池由入场费累积 (简化为这一种模式)。

开奖时间 (时间戳 uint256)

确认与部署： 用户确认信息，前端调用主合约的“发起抽奖”函数，部署新的 SimpleLottery 合约实例。

2.3 抽奖场次管理 (发起人权限)
查看场次详情： 发起人可以进入自己创建的抽奖场次页面，查看参与者列表、当前奖池等。

触发开奖： 在开奖时间到达后，发起人可以手动调用该场次合约的 drawWinner() 函数。

重置抽奖： 在奖金领取后，发起人可以调用 resetLottery() 重置。

2.4 参与抽奖 (基础版)
抽奖列表： 在主页显示所有已创建的抽奖列表 (名称, ID, 入场费, 当前奖池, 开奖时间, 状态)。

进入场次： 用户点击列表中的抽奖进入详情页面。

查看信息： 显示该场次的基本信息。

参与操作： 用户点击“参与”按钮，前端调用该场次合约的 enter() 函数，并支付入场费。

2.5 开奖与领奖 (基础版)
开奖触发： 达到时间后，发起人手动触发 drawWinner()。

中奖者确定： 合约执行伪随机数逻辑确定中奖者。

结果公布： 前端显示中奖者。

领奖操作： 中奖者进入场次页面，点击“领取奖金”按钮，调用 claimPrize()。

2.6 查询功能 (基础版)
通过 ID 查询： (可选，如果时间允许可以加上) 提供一个简单的输入框，输入 ID 查询。

列表展示： 主要通过主页的列表展示所有抽奖信息。

2.7 错误处理与提示 (基础版)
智能合约： 在核心操作中使用 require() 提供基本错误信息 (如入场费不正确，状态错误)。

前端： 捕获并显示这些基本错误信息。
